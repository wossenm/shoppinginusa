void function(exports,$){exports.JSNES_MediaSelectorView=Backbone.View.extend({events:{"click .back":"back","click .close":"close"},initialize:function(){this.defer(function(){this.filesView=this.attachView(new FilesView({collection:new FilesCollection}),".files-list");this.filesView.collection.fetch();this.update();this.$el.draggable({handle:".panel-heading",cancel:".btn"});this.listenTo(this.filesView.collection,"request",this.showLoading);this.listenTo(this.filesView.collection,"sync",this.hideLoading)})},update:function(){if(this.filesView.collection.path=="/")this.$(".back").addClass("hidden");else this.$(".back").removeClass("hidden");this.$(".path").html("images"+this.filesView.collection.path.replace(/\//g,' <span class="fa fa-angle-right"></span> '))},select:function(callback){this.open();this.once("file:select",function(){this.close();typeof callback!="function"||callback.apply(this,arguments)})},back:function(){this.filesView.collection.upOneLevel();this.update()},close:function(){this.$el.addClass("hidden");this.off("file:select")},open:function(){this.$el.removeClass("hidden").position({my:"center",at:"center",of:this.superView.el}).clickOutside(this.close,this)},showLoading:function(){this.$(".loading-spinner").removeClass("hidden")},hideLoading:function(){this.$(".loading-spinner").addClass("hidden")}});var FilesCollection=Backbone.Collection.extend({initialize:function(){this.baseURL=JSNES_CONFIG.URL.API_MEDIA_SELECTOR;this.path="/"},url:function(){return this.baseURL+this.path},changePath:function(filename){this.path+="/"+filename+"/";this.path=this.path.replace(/\/+/g,"/");this.fetch()},upOneLevel:function(){var names=_.compact(this.path.split("/"));if(names.length){names.pop();this.path=("/"+names.join("/")+"/").replace(/\/+/g,"/");this.fetch()}}});var FilesView=Backbone.CollectionView.extend({itemView:Backbone.ItemView.extend({tagName:"LI",className:"file-item",template:"#media-selector-file-template",events:{"click .dir":"openFolder","click .file":"selectFile"},initialize:function(){this.uriPrefix=$(".jsn-es-app").attr("data-uri");this.on("render",this.update);this.render()},openFolder:function(e){e.preventDefault();this.model.collection.changePath(this.model.get("filename"));this.superView.superView.update()},selectFile:function(e){e.preventDefault();this.superView.superView.trigger("file:select",this.model.toJSON())},update:function(){if(this.model.get("type")=="file")this.$(".file-icon").css({backgroundImage:"url("+this.uriPrefix+this.model.get("url")+")"})}})})}(this,JSNESjQuery);