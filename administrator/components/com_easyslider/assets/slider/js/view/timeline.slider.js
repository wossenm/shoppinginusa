void function(exports,$){exports.JSNES_TimelineSliderView=Backbone.View.extend({events:{"slidestop .slider-track":"slidechange","slidechange .slider-track":"updateTimeGuideLine","slide .slider-track":"updateTimeGuideLine","click .increase-time":"increaseTime","click .decrease-time":"decreaseTime"},initialize:function(){this.timeStep=500;this.timeMin=1e3},ready:function(){this.$el.disableSelection();this.$(".slider-track").get(0).slide=null;this.$(".slider-track").slider({min:0,step:1,max:100});this.listenTo(this.model,"change",this.render);$(window).on("resize",_.bind(this.render,this));this.render()},slidechange:function(){var $track=this.$(".slider-track");var left=$track.slider("value");var width=$track.width();var totalTime=this.model.get("transition.delay");var currentTime=Math.round(left/width*totalTime);this.model.set({currentTime:currentTime});this.superView.$(".jsn-es-layer").trigger("update:timeline:visible");this.updateTimeGuideLine()},updateTimeGuideLine:function(e,ui){this.superView.$(".jsn-es-timeline-guide").css({left:this.$(".slider-heading").outerWidth()+(ui?ui.value:this.$(".slider-track").slider("value"))})},render:function(){var $track=this.$(".slider-track");var $canvas=this.$("canvas");var totalTime=this.model.get("transition.delay");var ratio=$track.width()/totalTime;var left=ratio*this.model.get("currentTime");var step=Math.round(100/this.model.get("transition").get("delay")*$track.width());$canvas.attr("width",this.$(".slider-track-wrapper").width()).attr("height",this.$(".slider-track-wrapper").height());this.renderRuler();$track.slider().slider("option","max",$track.width());$track.slider().slider("value",left);this.updateTimeGuideLine()},increaseTime:function(){var delay=this.model.get("transition.delay");var newDelay=delay%this.timeStep==0?delay+this.timeStep:Math.ceil(delay/this.timeStep)*this.timeStep;this.model.set("transition.delay",newDelay)},decreaseTime:function(){var delay=this.model.get("transition.delay");if(delay<=this.timeMin)return;var newDelay=delay%this.timeStep==0?delay-this.timeStep:Math.floor(delay/this.timeStep)*this.timeStep;this.model.set("transition.delay",newDelay)},renderRuler:function(){var number=this.superView.model.get("transition.delay")/500;var left=this.$(".slider-track").width()/number;var height=10;var second=0;for(var i=0;i<=number;i++){if(i%2==0){height=20;second=i/2}else{second=-1;height=10}this.renderRulerMarker(Math.round(left*i)-1.5,height,second)}},renderRulerMarker:function(left,height,second){var $canvas=this.$("canvas");var maxHeight=$canvas.height();if(maxHeight<=0)maxHeight=35;if(second==0)left=left+1;var ctx=$canvas.get(0).getContext("2d");var firstColor="#121318";var secondColor="#2b2d35";var y=maxHeight-height;ctx.lineWidth=1;ctx.strokeStyle=secondColor;ctx.beginPath();ctx.moveTo(left+1,y);ctx.lineTo(left+1,maxHeight);ctx.stroke();if(parseInt(second)>=0){var textLeft=left-3;ctx.font='12px "Myriad Pro" sans-serif';ctx.fillStyle="#575b6b";ctx.textAlign="right";if(second==0){ctx.textAlign="left";textLeft=left+3}ctx.fillText(second+"s",textLeft,maxHeight-4)}},changeHandlePosition:function(e){var left=e.pageX-this.$(".slider-track").offset().left;this.$(".ui-slider-handle").css("left",left);$(this).trigger("slidechange")},getHandlePosition:function(){return this.$(".slider-track").slider("value")}})}(this,JSNESjQuery);