void function(exports,$,Backbone){_.templateSettings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{#([\s\S]+?)\}\}/g};Backbone.$=$;var Model=Backbone.Model;var Collection=Backbone.Collection;exports.log=console.log.bind(console);exports.JSNjQuery=$;Backbone.Model=Model.extend({constructor:function(){Model.apply(this,arguments);this.on("change",function(){this.parent&&this.parent.trigger.apply(this.parent,_(arguments).splice(0,0,"change"))})}});Backbone.Collection=Collection.extend({constructor:function(){Collection.apply(this,arguments)}});var BackboneGet=Backbone.Model.prototype.get;var BackboneSet=Backbone.Model.prototype.set;var arrayRegex=/^([a-zA-Z0-9_$]*)\[(\w)\]$/;_(Backbone.Model.prototype).extend({get:function(key){if(key.indexOf(".")>-1||key.indexOf("[")>-1){var result=this;var keys=key.split(".");while(keys.length){var currentKey=keys.shift(),arrayIndex=null;if(currentKey.match(arrayRegex)){var matchKey=currentKey.match(arrayRegex);currentKey=matchKey[1];arrayIndex=matchKey[2]}if(!result)return result;result=result.get(currentKey);if(arrayIndex!=null){result=lastModel=lastModel.at(arrayIndex)}}return result}else return BackboneGet.apply(this,arguments)},set:function(key,value){if(typeof key=="string"&&key.indexOf(".")>-1){var keys=key.split("."),obj=result={};while(keys.length){var k=keys.shift();keys.length?obj=obj[k]={}:obj[k]=value}return this.set(result)}else return BackboneSet.apply(this,arguments)}});_(Backbone.Collection.prototype).extend({comparator:function(model){return model.get("index")}});var BackboneView=Backbone.OriginalView=Backbone.View;Backbone.View=BackboneView.extend({constructor:function(){this.subViews=[];BackboneView.apply(this,arguments);!this.el.parentNode||this.ready()}});_(Backbone.View.prototype).extend({ready:function(){return this},freeze:function(){this._frozen=true;this.trigger("freeze");return this},unfreeze:function(){this._frozen=false;this.trigger("unfreeze");return this},preventDefault:function(e){e.preventDefault();return false},defer:function(fn,context){_.defer(_.bind(fn,context||this));return this},delay:function(fn,delay,context){_.delay(_.bind(fn,context||this),delay);return this},render:function(){this.trigger("before:render");this.trigger("render");return this},hasView:function(view){return this.subViews&&this.subViews.indexOf(view)>-1},attachView:function(view,selector){view.trigger("before:mount");this.hasView(view)||this.subViews.push(view);view.setElement(this.$(selector));view.superView=this;view.trigger("mount");view.ready();return view},appendView:function(view,selector){view.trigger("before:mount");this.hasView(view)||this.subViews.push(view);view.superView=this;view.$el.appendTo(selector?this.$(selector):this.el);view.trigger("mount");view.ready();return view},prependView:function(view,selector){view.trigger("before:mount");this.hasView(view)||this.subViews.push(view);view.superView=this;view.$el.prependTo(selector?this.$(selector):this.el);view.trigger("mount");view.ready();return view},remove:_.compose(function(){this.trigger("before:remove");return this},Backbone.View.prototype.remove,function(){this.superView&&this.superView.subViews&&_(this.superView.subViews).each(function(subView,index){if(subView&&subView.cid==this.cid)this.superView.subViews.splice(index,1)},this);this.trigger("remove");return this}),empty:function(){if(this.subViews)while(this.subViews.length)this.subViews[0].remove();return this},wipe:function(){for(var key in this)delete this[key];return this}});Backbone.ItemView=Backbone.View.extend({template:false,constructor:function(options){_(this).extend(_.pick(options,"template"));if(this.template)switch(typeof this.template){case"string":this.template=_.template(this.template.match("<")?this.template:$(this.template).html()||"");break}Backbone.View.apply(this,arguments);this.model||(this.model=new Backbone.Model);this.$el.attr("model-cid",this.model.cid);this.listenTo(this.model,"remove",this.remove)},initialize:function(){this.render()},render:function(model){this.trigger("before:render",model);if(this.template){var model=model||this.model;var data=model.toJSON?model.toJSON():model||{};try{this.$el.html(this.template(data))}catch(e){log("render error",model instanceof Backbone.Model,model)}}this.trigger("render",model);return this}});Backbone.CollectionView=Backbone.View.extend({itemView:Backbone.ItemView,constructor:function(options){this.queueItems=[];this.addQueueItems=_.debounce(this.addQueueItems);this.sort=_.debounce(this.sort);Backbone.View.apply(this,arguments);this.collection||(this.collection=new Backbone.Collection);this.listenTo(this.collection,"add",this.add);this.listenTo(this.collection,"reset",this.reset);this.listenTo(this.collection,"sort",this.sort);this.on("mount",this.reset)},freeze:function(){_(this.subViews).invoke("freeze");this.trigger("freeze");return this},unfreeze:function(){_(this.subViews).invoke("unfreeze");this.trigger("unfreeze");return this},add:function(model){this.queueItems.push(model);this.addQueueItems()},addQueueItems:function(){log("Collection :: add",this.queueItems.length,"items");while(this.queueItems.length){var view=this.appendView(new this.itemView({model:this.queueItems.shift()}));this.trigger("add",view)}this.trigger("add:multiple")},sort:function(){this.trigger("before:sort");this.collection.each(function(model){this.$el.children("*[model-cid="+model.cid+"]").appendTo(this.el)},this);this.trigger("sort")},reset:function(){this.empty();this.collection.each(this.add,this);return this}});$("body").on("click","[type=toggle]",function(e){e.preventDefault();$(this).attr("data-on",$(this).attr("data-on")=="true"?false:true).trigger("change")});$.fn.clickOutside=function(callback,context){return typeof callback!="function"?this:this.each(function(index,element){$(window).on("mousedown",function clickHandler(e){if(!$(element).is(e.target)&&!$(e.target).parents("."+$(element).attr("class").replace(/\s+/g,".")).length)$(window).off("mousedown",clickHandler),callback.call(context,e)})})};function getCenter(el){var $el=$(el);var offset=$el.offset();return{x:offset.left+$el.width()/2,y:offset.top+$el.height()/2}}function isWithinRange(value,target,tolerance){return value>=target-tolerance&&value<=target+tolerance}function getCenterSnapObjects(el,targets,tolerance){var $targets=$(targets);var center=getCenter(el);var snaps=$targets.map(function(){var targetCenter=getCenter(this);return{el:this,snapX:isWithinRange(center.x,targetCenter.x,tolerance||10),snapY:isWithinRange(center.y,targetCenter.y,tolerance||10),x:targetCenter.x,y:targetCenter.y,dX:targetCenter.x-center.x,dY:targetCenter.y-center.y}}).toArray();var snapX=_(snaps).chain().filter(function(match){return match.snapX}).sortBy(function(match){return Math.abs(match.dX)}).first().value();var snapY=_(snaps).chain().filter(function(match){return match.snapY}).sortBy(function(match){return Math.abs(match.dY)}).first().value();return{x:snapX,y:snapY}}$.fn.getSnapObjects=function(targets,tolerance){return getCenterSnapObjects(this,targets,tolerance)};$.fn.getObjectCenter=function(targets,tolerance){return getCenter(this)};$.fn.selectText=function(){var range,selection;return this.each(function(){if(document.body.createTextRange){range=document.body.createTextRange();range.moveToElementText(this);range.select()}else if(window.getSelection){selection=window.getSelection();range=document.createRange();range.selectNodeContents(this);selection.removeAllRanges();selection.addRange(range)}})};$.fn.deselectText=function(){var selection;return this.each(function(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}})};$.fn.jsnGetThumb=function(width,cb){var data;if(this.length){if(window.hasOwnProperty("html2canvas")){html2canvas(this.get(0),{onrendered:function(canvas){var src=canvas.toDataURL();var canvas,img;img=new Image;img.onload=function(){var ratio=img.width/width;canvas.width=img.width/ratio;canvas.height=img.height/ratio;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,canvas.width,canvas.height);data=canvas.toDataURL();typeof cb!="function"||cb(data)};img.src=src}})}}};$.fn.setCaretPosition=function(pos){var range;return this.each(function(){var elem=this;if(elem.createTextRange){range=elem.createTextRange();range.move("character",pos);range.select()}else{elem.focus();if(typeof elem.selectionStart!=="undefined"){elem.setSelectionRange(pos,pos)}}})};$.fn.getCaretPosition=function(){if(!this.length)return null;var input=this.get(0);if(!input)return;if(document.selection){input.focus()}return"selectionStart"in input?input.selectionStart:""||Math.abs(document.selection.createRange().moveStart("character",-input.value.length))};_.mixin({parseNumberUnit:function(str){str+="";var match=str.replace(/\s+/," ").match(/([-0-9.]+)\s?([^\s]*)?/);return{value:match&&parseFloat(match[1])||0,unit:match&&match[2]||""}},stripTags:function(str){return str.replace(/</g,"&lt;").replace(/>/g,"&gt;")},encodeHtmlEntities:function(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},decodeHtmlEntities:function(str){return String(str).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}});$("body").on("click",'.btn-group[data-toggle="jsn-es-buttons"] .btn',function(){if(!$(this).hasClass("active")){$(this).addClass("active").siblings().removeClass("active");$(this).parent().trigger("change")}});$("body").on("click",'.btn[data-toggle="jsn-es-button"]',function(){$(this).toggleClass("active").trigger("change")});$.fn.alignItems=function(alignment,target){log("align to target");var $target=$(target);var position=$target.position();var width=$target.width();var height=$target.height();return this.each(function(){if(target){var $el=$(this);var elemOffsetX=parseFloat($el.css("margin-left"));var elemOffsetY=parseFloat($el.css("margin-top"));var targetOffsetX=parseFloat($target.css("margin-left"));var targetOffsetY=parseFloat($target.css("margin-top"));var offsetX=elemOffsetX-targetOffsetX;var offsetY=elemOffsetY-targetOffsetY;if($el.parent().is(target)){position.left=0;position.top=0}switch(alignment){case"left":$el.css("left",position.left-offsetX);break;case"center":var center=position.left+width/2;$el.css("left",center-$el.width()/2-offsetX);break;case"right":var right=position.left+width;$el.css("left",right-$el.width()-offsetX);break;case"top":$el.css("top",position.top-offsetY);break;case"middle":var middle=position.top+height/2;$el.css("top",middle-$el.height()/2-offsetY);break;case"bottom":var bottom=position.top+height;$el.css("top",bottom-$el.height()-offsetY);break}}})};$.fn.wrapAllLetters=function(before,after){return this.each(function(){$(this).html($(this).html().replace(/(<[^>]*>)?([^<]*)(<[^>]*>)?/g,function(string,x,text,y){return!text.trim()?"":(x||"")+text.trim().split("").map(function(letter){return before+letter+after}).join("")+(y||"")}))})};$.fn.wrapAllWords=function(before,after){return this.each(function(){$(this).html($(this).html().replace(/(<[^>]*>)?([^<]*)(<[^>]*>)?/g,function(string,x,text,y){return!text.trim()?"":(x||"")+text.trim().split(/\s+/).map(function(word){return before+word+after}).join(" ")+(y||"")}))})};$.fn.playLettersAnimation=function(effect,duration,delay){return this.each(function(){var $self=$(this);var $effectClone=$(this).clone().appendTo($self.parent()).wrapAllLetters('<span class="anim-part">',"</span>").css({zIndex:99999999,position:"absolute"}).position({my:"center",at:"center",of:this});var $clones=$effectClone.find(".anim-part");var killClone=_.after($clones.length,function(){log("killed clone");$effectClone.remove();$self.show()});$self.hide();duration-=($clones.length-1)*delay;_.delay(function(){$clones.each(function(i){$(this).playKeyframe({name:effect,duration:duration+"ms",delay:i*delay+"ms",complete:killClone})})},10)})};$.fn.JSNES_cuboid=function(width,height,depth){return this.each(function(){depth||(depth=width);var halfWidth=width/2;var halfHeight=height/2;var halfDepth=depth/2;var setback=0;var $cuboid=$('<div class="jsn-es-cuboid">').appendTo(this).css({width:width+"px",height:height+"px"});$(this).css({transform:"translateZ("+-halfDepth+"px)"});$('<div class="jsn-es-cuboid-face jsn-es-cuboid-front">').appendTo($cuboid).css({transform:"translateZ("+setback+"px) translateZ("+halfDepth+"px)",width:width+"px",height:height+"px"});$('<div class="jsn-es-cuboid-face jsn-es-cuboid-back">').appendTo($cuboid).css({transform:"translateZ("+setback+"px) rotateY(180deg) translateZ("+halfDepth+"px)",width:width+"px",height:height+"px"});$('<div class="jsn-es-cuboid-face jsn-es-cuboid-left">').appendTo($cuboid).css({transform:"translateZ("+setback+"px) rotateY(-90deg) translateZ("+halfWidth+"px)",marginLeft:-halfDepth+"px",width:depth+"px",height:height+"px"});$('<div class="jsn-es-cuboid-face jsn-es-cuboid-right">').appendTo($cuboid).css({transform:"translateZ("+setback+"px) rotateY(90deg) translateZ("+halfWidth+"px)",marginLeft:-halfDepth+"px",width:depth+"px",height:height+"px"});$('<div class="jsn-es-cuboid-face jsn-es-cuboid-top">').appendTo($cuboid).css({transform:"translateZ("+setback+"px) rotateX(90deg) translateZ("+halfHeight+"px)",marginTop:-halfDepth+"px",width:width+"px",height:depth+"px"});$('<div class="jsn-es-cuboid-face jsn-es-cuboid-bottom">').appendTo($cuboid).css({transform:"translateZ("+setback+"px) rotateX(-90deg) translateZ("+halfHeight+"px)",marginTop:-halfDepth+"px",width:width+"px",height:depth+"px"})})}}(this,JSNESjQuery,Backbone);